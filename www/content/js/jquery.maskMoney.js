(function(e){e.fn.maskMoney=function(t){t=e.extend({symbol:"US$",decimal:".",precision:2,thousands:",",allowZero:false,allowNegative:false,showSymbol:false,symbolStay:false,defaultZero:true},t);return this.each(function(){function r(e){e=e||window.event;var t=e.charCode||e.keyCode||e.which;if(t==undefined)return false;if(t<48||t>57){if(t==45){n.val(h(n));return false}if(t==43){n.val(n.val().replace("-",""));return false}else if(t==13){return true}else{u(e);return true}}else if(n.val().length==n.attr("maxlength")){return false}else{u(e);var r=String.fromCharCode(t);var i=n.get(0);var s=n.getInputSelection(i);var o=s.start;var f=s.end;i.value=i.value.substring(0,o)+r+i.value.substring(f,i.value.length);a(i,o+1);return false}}function i(e){e=e||window.event;var t=e.charCode||e.keyCode||e.which;if(t==undefined)return false;var r=n.get(0);var i=n.getInputSelection(r);var s=i.start;var o=i.end;if(t==8){u(e);if(s==o){r.value=r.value.substring(0,s-1)+r.value.substring(o,r.value.length);s=s-1}else{r.value=r.value.substring(0,s)+r.value.substring(o,r.value.length)}a(r,s);return false}else if(t==9){return true}else if(t==46||t==63272){u(e);if(r.selectionStart==r.selectionEnd){r.value=r.value.substring(0,s)+r.value.substring(o+1,r.value.length)}else{r.value=r.value.substring(0,s)+r.value.substring(o,r.value.length)}a(r,s);return false}else{return true}}function s(e){if(n.val()==""&&t.defaultZero){n.val(c(l()))}else{n.val(c(n.val()))}if(this.createTextRange){var r=this.createTextRange();r.collapse(false);r.select()}}function o(i){if(e.browser.msie){r(i)}if(n.val()==c(l())){if(!t.allowZero)n.val("")}else{if(!t.symbolStay)n.val(n.val().replace(t.symbol,""));else if(t.symbolStay&&n.val()==t.symbol)n.val("")}}function u(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}function a(e,t){var r=n.val().length;n.val(f(e.value));var i=n.val().length;t=t-(r-i);n.setCursorPosition(t)}function f(e){e=e.replace(t.symbol,"");var n="0123456789";var r=e.length;var i="",s="",o="";if(r!=0&&e.charAt(0)=="-"){e=e.replace("-","");if(t.allowNegative){o="-"}}if(r==0){if(!t.defaultZero)return s;s="0.00"}for(var u=0;u<r;u++){if(e.charAt(u)!="0"&&e.charAt(u)!=t.decimal)break}for(;u<r;u++){if(n.indexOf(e.charAt(u))!=-1)i+=e.charAt(u)}var a=parseFloat(i);a=isNaN(a)?0:a/Math.pow(10,t.precision);s=a.toFixed(t.precision);u=t.precision==0?0:1;var f,l=(s=s.split("."))[u].substr(0,t.precision);for(f=(s=s[0]).length;(f-=3)>=1;){s=s.substr(0,f)+t.thousands+s.substr(f)}return t.precision>0?c(o+s+t.decimal+l+Array(t.precision+1-l.length).join(0)):c(o+s)}function l(){var e=parseFloat("0")/Math.pow(10,t.precision);return e.toFixed(t.precision).replace(new RegExp("\\.","g"),t.decimal)}function c(e){if(t.showSymbol){if(e.substr(0,t.symbol.length)!=t.symbol)return t.symbol+e}return e}function h(e){if(t.allowNegative){var n=e.val();if(e.val()!=""&&e.val().charAt(0)=="-"){return e.val().replace("-","")}else{return"-"+e.val()}}else{return e.val()}}var n=e(this);n.bind("keypress",r);n.bind("keydown",i);n.bind("blur",o);n.bind("focus",s);n.one("unmaskMoney",function(){n.unbind("focus",s);n.unbind("blur",o);n.unbind("keydown",i);n.unbind("keypress",r);if(e.browser.msie){this.onpaste=null}else if(e.browser.mozilla){this.removeEventListener("input",o,false)}})})};e.fn.unmaskMoney=function(){return this.trigger("unmaskMoney")};e.fn.setCursorPosition=function(e){this.each(function(t,n){if(n.setSelectionRange){n.focus();n.setSelectionRange(e,e)}else if(n.createTextRange){var r=n.createTextRange();r.collapse(true);r.moveEnd("character",e);r.moveStart("character",e);r.select()}});return this};e.fn.getInputSelection=function(e){var t=0,n=0,r,i,s,o,u;if(typeof e.selectionStart=="number"&&typeof e.selectionEnd=="number"){t=e.selectionStart;n=e.selectionEnd}else{i=document.selection.createRange();if(i&&i.parentElement()==e){o=e.value.length;r=e.value.replace(/\r\n/g,"\n");s=e.createTextRange();s.moveToBookmark(i.getBookmark());u=e.createTextRange();u.collapse(false);if(s.compareEndPoints("StartToEnd",u)>-1){t=n=o}else{t=-s.moveStart("character",-o);t+=r.slice(0,t).split("\n").length-1;if(s.compareEndPoints("EndToEnd",u)>-1){n=o}else{n=-s.moveEnd("character",-o);n+=r.slice(0,n).split("\n").length-1}}}}return{start:t,end:n}}})(jQuery)